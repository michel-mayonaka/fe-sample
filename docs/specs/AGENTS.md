# specs/AGENTS — 仕様の読み方ガイド（エージェント向け）

この文書は、コーディングエージェントが `docs/specs/` 配下の仕様をどのように参照し、実装やリファクタリングに反映するかのガイドです。人間の開発者も参照できますが、特にエージェント向けの前提・優先順位を明示します。

## 1. 参照の優先順位
1. ストーリー/タスク: `stories/YYYYMMDD-slug/README.md` および `tasks/*.md`
2. 仕様: `docs/specs/system/`, `docs/specs/ui/` など該当カテゴリ
3. アーキテクチャ/命名: `docs/ARCHITECTURE.md`, `docs/NAMING.md`, `docs/COMMENT_STYLE.md`
4. その他ドキュメント: `docs/AI_OPERATIONS.md`, `docs/DB_NOTES.md` など
5. コード本体: `cmd/`, `internal/`, `pkg/` 等

- 仕様とコードが矛盾する場合は、**まず仕様（specs）側を優先しつつ、矛盾を検出した旨をコメントで残す** ことを推奨します。
- specs に該当する情報が無い場合は、ストーリー/タスク側の意図や既存コードの挙動を尊重しつつ、必要に応じて specs へ追記できるよう提案してください。

## 2. 仕様ドキュメントの読み方
- system: `docs/specs/system/`
  - システム全体のユースケース、シーケンス、ドメインルールなどが記述されます。
  - ここから「何ができるシステムか」「どんな制約があるか」を把握してください。
- ui: `docs/specs/ui/`
  - 画面単位の構成・状態・入力と反応を記述します。
  - ここから「どの画面でどの情報をどう見せるか」「どの入力にどう振る舞うか」を把握してください。

仕様に記載されていない挙動や端ケースは、勝手に拡張せず、保守的（安全側）に判断してください。

## 3. 矛盾・不明点への対応
- 仕様同士、または仕様とコードの間に矛盾を見つけた場合:
  - どのファイル・どの記述が矛盾しているかを明示したうえで、より一貫性の高い案をコメントとして提案してください。
  - 可能であれば、`stories/discovery/` に Discovery として起票することを検討してください（人間の開発者が後で整理できるようにするため）。
- 不明点が多く仕様が不足している場合:
  - 仕様を補うために必要な質問や確認事項を列挙し、ストーリー/タスク側にフィードバックしてください。

## 4. 仕様追従時の方針
- 仕様変更に伴いコードを修正する際は、**必ず関連する specs を先に更新し、そのうえでコード側を変更** してください。
- 仕様に大きな変更が入る場合は、ストーリーを切ってから対応し、`docs/specs/` の更新と実装を同一ストーリーで追跡できるようにします。

## 5. 今後の拡張
- `docs/specs/system/` や `docs/specs/ui/` にテンプレートやサンプルを追加し、仕様の粒度や書き方を統一していきます。
- 必要に応じて `docs/specs/domain/`, `docs/specs/api/` などのカテゴリを追加し、参照しやすく整理します。

エージェントは、ここで定義された優先順位と方針に従って仕様を解釈し、過度な推測を避けつつ、足りない部分はストーリー/Discovery への提案という形で補完してください。
