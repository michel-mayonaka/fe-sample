# ステータス画面仕様（ui spec）

状態: impl-done
主な実装: internal/game/scenes/status, internal/game/ui/draw/status.go, internal/game/ui/layout/status.go
最新ストーリー: 20251117-spec-status-metadata

## 1. 画面概要
- 画面名: ステータス画面
- 目的: 選択中のユニットの詳細ステータス（基本能力・成長率・武器/魔法ランク・装備・ポートレート）を一覧し、戦闘画面への入り口を提供する。
- 対象ユーザ: プレイヤー（開発者にとっては UI レイアウト/表示仕様の確認用）。

## 2. レイアウト（概要）
- 全体
  - 画面解像度: 1920x1080 を前提としたレイアウト。
  - 画面全体に「ステータスパネル」が表示される（`DrawPanel`）。
- 左上: ポートレート枠
  - 320x320 の矩形内にユニットのポートレートを表示。
  - 画像が無い場合はプレースホルダ（`DrawPortraitPlaceholder`）を描画する。
- 左上〜中央: 基本情報
  - 項目: 名前、クラス、レベル/経験値、HP（バー表示含む）。
  - 表示例: `Lv 10 / 20    経験値 30 / 100`, `HP 20/25`。
- 中央〜右: 基本ステータス
  - 左カラム: 力/魔力/技/速さ。
  - 右カラム: 幸運/守備/魔防/体格/攻撃速度。
  - 各行に「値」と「成長率（%）」を表示（攻撃速度のみ成長率なし）。
- 右側: 武器/魔法ランク
  - 「武器レベル」: 剣/槍/斧/弓 のランクを表示。
  - 「魔法レベル」: 理/光/闇/杖 のランクを表示。
- 下部: 装備リスト
  - タイトル「装備」の下に 5 行のスロットを描画。
  - 各行: 「名称」「耐久（現在/最大）」を表示。
  - 空スロットは `- 空 -` / `-` を表示。

## 3. 表示内容
- ユニット基本情報
  - 名前: ユニット名（文字列）。
  - クラス: クラス名（例: ソードマスター 等）。
  - レベル/経験値: `Lv {現在レベル} / {レベル上限}`, `経験値 {現在} / {必要EXP}`。
  - HP: `HP {現在HP}/{最大HP}` と HP バー（`DrawHPBar`）。
- 能力値
  - 力/魔力/技/速さ/幸運/守備/魔防/体格: 各能力値と成長率（`{値}`, `{成長率}%`）。
  - 攻撃速度: 派生値（成長率表示はなし）。
- ランク
  - 武器ランク: 剣/槍/斧/弓ごとにランク（例: E〜S または `-`）。
  - 魔法ランク: 理/光/闇/杖ごとにランク（例: E〜S または `-`）。
- 装備
  - 各スロット: `- {名称}` と `残り耐久/最大耐久` を表示。
  - 耐久が無い装備は `-` 表示（実装依存）。

## 4. 入力と挙動（概要）
- 前提
  - 入力の詳細なマッピング（キー/ボタン）は Scene 側（`internal/game/scenes/status`）で扱い、本 spec では画面としての挙動の概要のみを扱う。
- 想定挙動
  - ステータス画面への遷移: キャラクター一覧画面でユニットを選択した際に遷移。
  - 戦闘画面への遷移: 画面右下の「戦闘へ」操作で戦闘プレビュー/戦闘画面へ遷移（戦闘仕様は `docs/specs/system/battle_basic.md` 参照）。
  - 戻る/閉じる: 適切なキー入力（例: Cancel/Esc）で一覧画面など前の画面に戻る（具体キーは Scene 実装に委ねる）。

## 5. 状態遷移
- この画面への遷移元
  - キャラクター一覧画面（ユニット行選択 → ステータス画面を開く）。
- この画面からの遷移先
  - 戦闘プレビュー/戦闘画面（「戦闘へ」操作）。
  - 一覧画面など前の画面（「戻る」操作）。

## 6. エラー・例外
- ポートレート画像の読み込みに失敗した場合
  - 画像無しとしてプレースホルダ表示にフォールバックする。
- ステータス値/ランク/装備が欠損している場合
  - ゼロ値または `-` を表示する（クラッシュやパニックを避ける）。

## 7. テスト観点
- レイアウト/表示
  - 代表的なユニット1体で、各項目（名前/クラス/レベル/HP/能力値/ランク/装備）が正しい位置に表示されること。
  - 装備スロットが 0〜5 個の場合に表示が崩れないこと。
- 振る舞い（連携）
  - キャラクター一覧からステータス画面への遷移が意図どおり行われること。
  - ステータス画面から戦闘画面への遷移ができ、 `battle_basic` の仕様どおり戦闘が実行されること。

## 8. 備考
- レイアウトの詳細値（ピクセル単位のオフセット/サイズ）は `internal/game/ui/layout/status.go` および `internal/game/service/ui` の定数定義に従う。
- カラー/フォントなどのスタイルは、UI サービス層（`internal/game/service/ui`）のポリシーに準拠する。
